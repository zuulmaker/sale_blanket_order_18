<?xml version="1.0" encoding="utf-8"?>
<!--
# -*- coding: utf-8 -*-
# License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl).
# Date: 2025-05-30
# Author: j.s.drees@az-zwick.com

Sale Blanket Order Views
===================================================

Komplette View-Definitionen für das Blanket Order System.

Anwendungsbeispiele:
- Blanket Order Form und Tree Views
- Search Views mit Filtern
- Actions und Context-Menüs
- Fehlertolerant und Benutzerfreundlich
-->

<odoo>

        <record id="view_blanket_order_form" model="ir.ui.view">
            <field name="name">sale.blanket.order.form</field>
            <field name="model">sale.blanket.order</field>
            <field name="arch" type="xml">
                <form string="Blanket Order" class="o_sale_order o_responsive_form">
                    <header>
                        <field name="state" widget="statusbar"
                               statusbar_visible="draft,open,cancel,expired,done" aria-label="Status"/>
                        <button name="action_confirm" string="Confirm" type="object"
                                invisible="state != 'draft'" class="btn-primary"
                                confirm="Are you sure you want to confirm this blanket order?" help="Confirm this order and make it active"/>
                        <button name="action_create_sale_order" string="Create Sale Order"
                                type="object" invisible="state != 'open'" class="btn-primary" help="Create a new record"/>
                        <button name="action_set_to_draft" string="Reset to Draft"
                                type="object" invisible="state not in ['cancel', 'expired']"
                                confirm="This will reset the blanket order to draft. Continue?"/>
                        <button name="action_cancel" string="Cancel" type="object"
                                invisible="state not in ['draft', 'open']"
                                confirm="Are you sure you want to cancel this blanket order?" help="Cancel this order"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box">
                            <button type="object" name="action_view_sale_orders"
                                    class="oe_stat_button" icon="fa-shopping-cart">
                                <field name="sale_order_count" widget="statinfo"
                                       string="Sale Orders"/>
                            </button>
                            <button class="oe_stat_button" icon="fa-list-ol">
                                <field name="order_line_count" widget="statinfo"
                                       string="Order Lines"/>
                            </button>
                        </div>
                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1" class="o_text_overflow" aria-label="Reference"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <label for="partner_id"/>
                                <field name="partner_id" widget="many2one"
                                       context="{'show_vat': True}"/>
                                <field name="partner_invoice_id"
                                       options="{'no_open': True, 'no_create': True}"/>
                                <field name="partner_shipping_id"
                                       options="{'no_open': True, 'no_create': True}"/>
                                <field name="date_order" widget="datetime"/>
                                <field name="validity_date" required="1"/>
                            </group>
                            <group>
                                <field name="user_id" widget="many2one_avatar_user" optional="show"/>
                                <field name="team_id" options="{'no_open': True}"/>
                                <field name="company_id" groups="base.group_multi_company" optional="hide"/>
                                <field name="pricelist_id" groups="product.group_sale_pricelist"/>
                                <field name="currency_id" invisible="1"/>
                                <field name="payment_term_id"/>
                            </group>
                        </group>

                        <div class="oe_subtotal_footer oe_right">
                            <t t-foreach="[('amount_untaxed', 'Untaxed Amount'),
                                           ('amount_tax', 'Tax'),
                                           ('amount_total', 'Total')]"
                              t-as="line">
                                <label t-attf-for="{{ line[0] }}"/>
                                <field t-att-name="line[0]" widget="monetary"
                                       t-att-options="{'currency_field': 'currency_id'}"
                                       t-att-string="line[1]"/>
                            </t>
                        </div>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_partner_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="view_blanket_order_tree" model="ir.ui.view">
            <field name="name">sale.blanket.order.tree</field>
            <field name="model">sale.blanket.order</field>
            <field name="arch" type="xml">
                <tree string="Blanket Orders" decoration-bf="state == 'draft'" sample="1" multi_edit="1">
                    <t t-set="decoration" t-value="{
                        'draft': 'text-info',
                        'open': 'text-success',
                        'expired': 'text-warning',
                        'cancel': 'text-muted'
                    }"/>
                    <field name="name" t-att-class="decoration.get(state)"/>
                    <field name="partner_id" />
                    <field name="user_id" widget="many2one_avatar_user" optional="show"/>
                    <field name="date_order" widget="date"/>
                    <field name="validity_date" widget="date" optional="show"/>
                    <field name="amount_untaxed" widget="monetary"
                           options="{'currency_field': 'currency_id'}" optional="show"/>
                    <field name="amount_total" widget="monetary"
                           options="{'currency_field': 'currency_id'}"/>
                    <field name="currency_id" invisible="1"/>
                    <field name="state" widget="badge"/>
                </tree>
            </field>
        </record>

        <record id="view_blanket_order_filter" model="ir.ui.view">
            <field name="name">sale.blanket.order.search</field>
            <field name="model">sale.blanket.order</field>
            <field name="arch" type="xml">
                <search>
                    <field name="name"/>
                    <field name="partner_id"/>
                    <field name="user_id" optional="show"/>
                    <filter string="My Orders" name="my_orders" domain="[('user_id','=',uid)]"/>
                    <filter string="Draft" name="draft" domain="[('state','=','draft')]"/>
                    <filter string="Open" name="open" domain="[('state','=','open')]"/>
                    <filter string="Expired" name="expired" domain="[('state','=','expired')]"/>
                    <filter string="Today" name="today"
                            domain="[('date_order','&gt;=',context_today().strftime('%Y-%m-%d 00:00:00')),
                                    ('date_order','&lt;=',context_today().strftime('%Y-%m-%d 23:59:59'))]"/>
                    <filter string="This Week" name="week"
                            domain="[('date_order','&gt;=', (context_today() - 6).strftime('%Y-%m-%d'))]"/>
                    <filter string="This Month" name="month"
                            domain="[('date_order','&gt;=', context_today().replace(day=1).strftime('%Y-%m-%d'))]"/>
                    <filter string="Expiring Soon" name="expiring_soon"
                            domain="[('validity_date','&lt;=', (context_today() + 7).strftime('%Y-%m-%d'))]"/>
                    <filter string="Has Remaining Qty" name="has_remaining"
                            domain="[('line_ids.remaining_uom_qty','&gt;',0)]"/>
                    <group expand="0" string="Group By">
                        <filter string="Customer" name="group_partner" context="{'group_by':'partner_id'}"/>
                        <filter string="Salesperson" name="group_user" context="{'group_by':'user_id'}"/>
                        <filter string="Status" name="group_state" context="{'group_by':'state'}"/>
                        <filter string="Order Date" name="group_date" context="{'group_by':'date_order:month'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="action_blanket_orders" model="ir.actions.act_window">
            <field name="name">Blanket Orders</field>
            <field name="res_model">sale.blanket.order</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_blanket_order_filter"/>
            <field name="context">{'search_default_open': 1}</field>
        </record>
        <menuitem id="menu_blanket_orders"
                  name="Blanket Orders"
                  parent="sale.sale_menu_root"
                  action="action_blanket_orders" sequence="10" active="True"/>

</odoo>